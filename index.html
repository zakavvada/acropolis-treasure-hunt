<!DOCTYPE html>
<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                           VERSION 7 - FINAL                                  ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üÜï CHANGES IN V7:
   ‚úÖ REMOVED: Credit card puzzle completely
   ‚úÖ KEPT: Beautiful UI from V5 (big buttons, progress bar, testing section)
   ‚úÖ Flow: Phase 1 (11 questions) ‚Üí Phase 2 (10 NFCs) ‚Üí Phase 3 (Navigation + Final) ‚Üí Victory
   ‚úÖ Real-time timer (continues even when app is closed)
   ‚úÖ Simplified navigation - needle + distance + light
   ‚úÖ Final stats screen (time, correct answers, helps used)

üìä CONFIGURATION:
   - Quiz Answers: 09, 26, 11, 03, 18, 06, 13, 21, 04, 29, 12
   - NFC Sequence: 6 ‚Üí 8 ‚Üí 3 ‚Üí 1 ‚Üí 5 ‚Üí 7 ‚Üí 2 ‚Üí 9 ‚Üí 4 ‚Üí 10
   - Final Answer: 480
   - Timer: 90 minutes (real-time tracking)
   - Location: 37.955326, 23.725608 (5m radius)

üéÆ SHORTCUTS:
   00 ‚Üí Skip to Phase 2
   31 ‚Üí Skip to Phase 3

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e1b4b">
    <title>Acropolis Treasure Hunt - v7</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Trophy = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
            </svg>
        );

        const RotateCcw = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
            </svg>
        );

        const User = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
        );

        const Lightbulb = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
        );

        const TreasureHunt = () => {
          const CORRECT_ANSWERS = ['09', '26', '11', '03', '18', '06', '13', '21', '04', '29', '12'];
          const SHORTCUT_PHASE2 = '00';
          const SHORTCUT_PHASE3 = '31';
          const CORRECT_NFC_SEQUENCE = [6, 8, 3, 1, 5, 7, 2, 9, 4, 10];
          const FINAL_ANSWER = '480';
          const TARGET_LAT = 37.955326;
          const TARGET_LNG = 23.725608;
          const UNLOCK_RADIUS = 5;
          const INITIAL_TIME = 90 * 60;

          const [phase, setPhase] = useState('phase1');
          const [currentQuestion, setCurrentQuestion] = useState(1);
          const [input, setInput] = useState('');
          const [phidiasUsed, setPhidiasUsed] = useState(false);
          const [periclesUsed, setPericlesUsed] = useState(false);
          const [feedback, setFeedback] = useState(null);
          const [scannedSequence, setScannedSequence] = useState([]);
          const [needsJoker, setNeedsJoker] = useState(false);
          const [jokerMessage, setJokerMessage] = useState('');
          const [userLocation, setUserLocation] = useState(null);
          const [distance, setDistance] = useState(null);
          const [bearing, setBearing] = useState(0);
          const [locationUnlocked, setLocationUnlocked] = useState(false);
          const [gpsEnabled, setGpsEnabled] = useState(false);
          const [gpsError, setGpsError] = useState('');
          const [gameStartTime, setGameStartTime] = useState(null);
          const [timeRemaining, setTimeRemaining] = useState(INITIAL_TIME);
          const [gameOver, setGameOver] = useState(false);
          const [showFinalQuestion, setShowFinalQuestion] = useState(false);
          const [finalAnswer, setFinalAnswer] = useState('');
          const [finalComplete, setFinalComplete] = useState(false);
          const [gameStats, setGameStats] = useState({ totalTime: 0, correctAnswers: 0, jokersUsed: 0 });
          
          const audioContextRef = useRef(null);
          const beepIntervalRef = useRef(null);
          const watchIdRef = useRef(null);

          useEffect(() => {
            const saved = localStorage.getItem('gameState_v7');
            if (saved) {
              try {
                const state = JSON.parse(saved);
                setPhase(state.phase || 'phase1');
                setCurrentQuestion(state.currentQuestion || 1);
                setPhidiasUsed(state.phidiasUsed || false);
                setPericlesUsed(state.periclesUsed || false);
                setScannedSequence(state.scannedSequence || []);
                setGameStartTime(state.gameStartTime);
                setShowFinalQuestion(state.showFinalQuestion || false);
                setFinalComplete(state.finalComplete || false);
                setGameStats(state.gameStats || { totalTime: 0, correctAnswers: 0, jokersUsed: 0 });
              } catch (err) {
                console.error('Failed to restore state:', err);
              }
            }

            // Handle NFC URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const nfcId = urlParams.get('nfc');
            if (nfcId && phase === 'phase2') {
              const nfcNumber = parseInt(nfcId, 10);
              if (nfcNumber >= 1 && nfcNumber <= 10) {
                setTimeout(() => handleNFCScan(nfcNumber), 500);
              }
            }
          }, []);

          useEffect(() => {
            if (phase !== 'phase1') {
              const state = {
                phase,
                currentQuestion,
                phidiasUsed,
                periclesUsed,
                scannedSequence,
                gameStartTime,
                showFinalQuestion,
                finalComplete,
                gameStats
              };
              localStorage.setItem('gameState_v7', JSON.stringify(state));
            }
          }, [phase, currentQuestion, phidiasUsed, periclesUsed, scannedSequence, gameStartTime, showFinalQuestion, finalComplete, gameStats]);

          useEffect(() => {
            if (gameStartTime && !gameOver && !finalComplete) {
              const interval = setInterval(() => {
                const now = Date.now();
                const elapsed = Math.floor((now - gameStartTime) / 1000);
                let remaining = INITIAL_TIME - elapsed;
                if (remaining <= 0) {
                  remaining = 0;
                  setGameOver(true);
                  clearInterval(interval);
                }
                setTimeRemaining(remaining);
              }, 1000);
              return () => clearInterval(interval);
            }
          }, [gameStartTime, gameOver, finalComplete]);

          const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };

          const resetGame = () => {
            localStorage.removeItem('gameState_v7');
            window.location.reload();
          };

          const handleNumberClick = (num) => {
            if (input.length < 2) {
              setInput(input + num);
            }
          };

          const handleClear = () => {
            setInput('');
            setFeedback(null);
          };

          const handleSubmit = () => {
            if (input.length !== 2) return;

            const idx = currentQuestion - 1;

            if (input === SHORTCUT_PHASE2) {
              setPhase('transition');
              setGameStartTime(Date.now());
              setInput('');
              setFeedback(null);
              return;
            }

            if (input === SHORTCUT_PHASE3) {
              setPhase('phase3');
              setGameStartTime(Date.now());
              setScannedSequence(CORRECT_NFC_SEQUENCE);
              setInput('');
              setFeedback(null);
              return;
            }

            const isCorrect = input === CORRECT_ANSWERS[idx];

            if (isCorrect) {
              setGameStats(prev => ({ ...prev, correctAnswers: prev.correctAnswers + 1 }));
              setFeedback({ type: 'correct', message: '‚úì CORRECT!' });
              setTimeout(() => {
                if (currentQuestion === 11) {
                  setPhase('transition');
                  setGameStartTime(Date.now());
                } else {
                  setCurrentQuestion(currentQuestion + 1);
                  setFeedback(null);
                }
                setInput('');
              }, 1500);
            } else {
              setFeedback({ type: 'wrong', message: '‚úó WRONG!' });
              setNeedsJoker(true);
            }
          };

          const handleJoker = (type) => {
            if (!needsJoker) return;
            
            const idx = currentQuestion - 1;
            
            if (type === 'phidias' && !phidiasUsed) {
              setPhidiasUsed(true);
              setJokerMessage(`Answer: ${CORRECT_ANSWERS[idx]}`);
              setGameStats(prev => ({ ...prev, jokersUsed: prev.jokersUsed + 1 }));
              setNeedsJoker(false);
              setFeedback(null);
              setInput('');
              setTimeout(() => setJokerMessage(''), 4000);
            } else if (type === 'pericles' && !periclesUsed && currentQuestion < 11) {
              setPericlesUsed(true);
              setJokerMessage('Skip to next question!');
              setGameStats(prev => ({ ...prev, jokersUsed: prev.jokersUsed + 1 }));
              setTimeout(() => {
                setCurrentQuestion(currentQuestion + 1);
                setNeedsJoker(false);
                setFeedback(null);
                setJokerMessage('');
                setInput('');
              }, 2000);
            }
          };

          const startPhase2 = () => {
            setPhase('phase2');
            setFeedback(null);
            setInput('');
          };

          const handleNFCScan = (nfcId) => {
            if (scannedSequence.includes(nfcId)) {
              setFeedback({ type: 'error', message: '‚ö†Ô∏è Already scanned!' });
              setTimeout(() => setFeedback(null), 2000);
              return;
            }

            const expectedNext = CORRECT_NFC_SEQUENCE[scannedSequence.length];

            if (nfcId === expectedNext) {
              const newSequence = [...scannedSequence, nfcId];
              setScannedSequence(newSequence);
              setFeedback({ type: 'correct', message: `Card ${nfcId} ‚úì` });

              if (newSequence.length === 10) {
                setTimeout(() => {
                  setPhase('phase3');
                  setFeedback(null);
                }, 1500);
              } else {
                setTimeout(() => setFeedback(null), 1500);
              }
            } else {
              setFeedback({ type: 'wrong', message: 'Wrong card! Reset!' });
              setTimeout(() => {
                setScannedSequence([]);
                setFeedback({ type: 'error', message: 'Sequence reset!' });
                setTimeout(() => setFeedback(null), 2000);
              }, 1500);
            }
          };

          const calculateDistance = (lat1, lng1, lat2, lng2) => {
            const R = 6371e3;
            const œÜ1 = (lat1 * Math.PI) / 180;
            const œÜ2 = (lat2 * Math.PI) / 180;
            const ŒîœÜ = ((lat2 - lat1) * Math.PI) / 180;
            const ŒîŒª = ((lng2 - lng1) * Math.PI) / 180;
            const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) + Math.cos(œÜ1) * Math.cos(œÜ2) * Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
          };

          const calculateBearing = (lat1, lng1, lat2, lng2) => {
            const œÜ1 = (lat1 * Math.PI) / 180;
            const œÜ2 = (lat2 * Math.PI) / 180;
            const ŒîŒª = ((lng2 - lng1) * Math.PI) / 180;
            const y = Math.sin(ŒîŒª) * Math.cos(œÜ2);
            const x = Math.cos(œÜ1) * Math.sin(œÜ2) - Math.sin(œÜ1) * Math.cos(œÜ2) * Math.cos(ŒîŒª);
            const Œ∏ = Math.atan2(y, x);
            return ((Œ∏ * 180) / Math.PI + 360) % 360;
          };

          const getBeepInterval = (dist) => {
            if (dist > 50) return 3000;
            if (dist > 20) return 1500;
            if (dist > 10) return 800;
            if (dist > 5) return 400;
            return 200;
          };

          const enableGPS = () => {
            if (!navigator.geolocation) {
              setGpsError('GPS not supported');
              return;
            }

            setGpsEnabled(true);
            setGpsError('');

            watchIdRef.current = navigator.geolocation.watchPosition(
              (position) => {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;
                setUserLocation({ lat: userLat, lng: userLng });

                const dist = calculateDistance(userLat, userLng, TARGET_LAT, TARGET_LNG);
                setDistance(dist);

                const bear = calculateBearing(userLat, userLng, TARGET_LAT, TARGET_LNG);
                setBearing(bear);

                if (dist <= UNLOCK_RADIUS && !locationUnlocked) {
                  setLocationUnlocked(true);
                  setShowFinalQuestion(true);
                }

                if (beepIntervalRef.current) clearInterval(beepIntervalRef.current);
                const interval = getBeepInterval(dist);
                beepIntervalRef.current = setInterval(() => {
                  if (!audioContextRef.current) audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                  const ctx = audioContextRef.current;
                  const osc = ctx.createOscillator();
                  const gain = ctx.createGain();
                  osc.connect(gain);
                  gain.connect(ctx.destination);
                  osc.frequency.value = 800;
                  gain.gain.value = 0.1;
                  osc.start();
                  osc.stop(ctx.currentTime + 0.1);
                }, interval);

                setGpsError('');
              },
              (error) => {
                console.error('GPS error:', error);
                setGpsError(`GPS error: ${error.message}`);
              },
              { enableHighAccuracy: true, maximumAge: 1000, timeout: 5000 }
            );
          };

          const handleFinalAnswer = () => {
            if (finalAnswer === FINAL_ANSWER) {
              const totalTime = INITIAL_TIME - timeRemaining;
              setGameStats(prev => ({ ...prev, totalTime }));
              setFinalComplete(true);
              setFeedback({ type: 'correct', message: '‚úì CORRECT!' });
              if (watchIdRef.current) navigator.geolocation.clearWatch(watchIdRef.current);
              if (beepIntervalRef.current) clearInterval(beepIntervalRef.current);
            } else {
              setFeedback({ type: 'incorrect', message: '‚úó WRONG! Try again.' });
              setTimeout(() => setFeedback(null), 2000);
            }
          };

          if (gameOver) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-gray-900 to-black p-4 flex items-center justify-center">
                <div className="text-center max-w-md">
                  <div className="text-6xl mb-6">‚è∞</div>
                  <h1 className="text-3xl font-bold text-white mb-4">Time's Up!</h1>
                  <p className="text-gray-300 text-lg mb-8">The quest has ended. Better luck next time!</p>
                  <button onClick={resetGame} className="bg-blue-500 hover:bg-blue-600 text-white text-xl font-bold px-8 py-4 rounded-lg transition active:scale-95 flex items-center gap-2 mx-auto">
                    <RotateCcw className="w-6 h-6" />Try Again
                  </button>
                </div>
              </div>
            );
          }

          if (phase === 'phase1') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4 flex items-center justify-center">
                <div className="w-full max-w-md">
                  <div className="text-center mb-6">
                    <div className={`text-3xl font-mono font-bold ${timeRemaining < 300 ? 'text-red-400 animate-pulse' : timeRemaining < 600 ? 'text-yellow-300' : 'text-green-300'}`}>
                      ‚è±Ô∏è {formatTime(timeRemaining)}
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-2 mb-6">
                    <div className="bg-white/10 backdrop-blur rounded-lg p-3 text-center">
                      <div className="text-yellow-300 text-sm">Question</div>
                      <div className="text-white text-2xl font-bold">{currentQuestion}/11</div>
                    </div>
                    <div className="grid grid-cols-2 gap-2">
                      <button onClick={() => handleJoker('phidias')} disabled={phidiasUsed || !needsJoker} className={`${phidiasUsed ? 'bg-gray-500/30' : 'bg-blue-500/30 hover:bg-blue-500/50'} backdrop-blur rounded-lg p-2 text-center transition ${needsJoker && !phidiasUsed ? 'ring-2 ring-blue-400 animate-pulse' : ''}`}>
                        <User className={`w-6 h-6 mx-auto mb-1 ${phidiasUsed ? 'text-gray-400' : 'text-blue-300'}`} />
                        <div className={`text-xs ${phidiasUsed ? 'text-gray-400' : 'text-blue-200'}`}>Phidias</div>
                      </button>
                      <button onClick={() => handleJoker('pericles')} disabled={periclesUsed || !needsJoker} className={`${periclesUsed ? 'bg-gray-500/30' : 'bg-purple-500/30 hover:bg-purple-500/50'} backdrop-blur rounded-lg p-2 text-center transition ${needsJoker && !periclesUsed ? 'ring-2 ring-purple-400 animate-pulse' : ''}`}>
                        <Lightbulb className={`w-6 h-6 mx-auto mb-1 ${periclesUsed ? 'text-gray-400' : 'text-purple-300'}`} />
                        <div className={`text-xs ${periclesUsed ? 'text-gray-400' : 'text-purple-200'}`}>Pericles</div>
                      </button>
                    </div>
                  </div>
                  <div className="bg-white/10 backdrop-blur rounded-lg p-6 mb-6 min-h-32 flex flex-col items-center justify-center">
                    <div className="text-white text-6xl font-mono mb-4 tracking-widest">{input || '--'}</div>
                    {jokerMessage && <div className="text-2xl font-bold text-yellow-400 animate-pulse mb-2">{jokerMessage}</div>}
                    {feedback && <div className={`text-2xl font-bold animate-pulse ${feedback.type === 'correct' ? 'text-green-400' : feedback.type === 'wrong' ? 'text-red-400' : 'text-orange-400'}`}>{feedback.message}</div>}
                    {!feedback && !jokerMessage && !needsJoker && <div className="text-gray-400 text-sm">Enter photo number</div>}
                    {needsJoker && <div className="text-red-400 text-lg font-bold animate-pulse">Use a Joker to continue!</div>}
                  </div>
                  <div className="grid grid-cols-3 gap-3 mb-4">
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                      <button key={num} onClick={() => handleNumberClick(num.toString())} disabled={needsJoker} className={`${needsJoker ? 'bg-gray-500/20 cursor-not-allowed' : 'bg-white/20 hover:bg-white/30'} backdrop-blur text-white text-3xl font-bold py-6 rounded-lg transition active:scale-95`}>{num}</button>
                    ))}
                    <button onClick={handleClear} disabled={needsJoker} className={`${needsJoker ? 'bg-gray-500/30 cursor-not-allowed' : 'bg-red-500/30 hover:bg-red-500/50'} text-white text-xl font-bold py-6 rounded-lg transition active:scale-95`}>CLEAR</button>
                    <button onClick={() => handleNumberClick('0')} disabled={needsJoker} className={`${needsJoker ? 'bg-gray-500/20 cursor-not-allowed' : 'bg-white/20 hover:bg-white/30'} backdrop-blur text-white text-3xl font-bold py-6 rounded-lg transition active:scale-95`}>0</button>
                    <button onClick={handleSubmit} disabled={needsJoker} className={`${needsJoker ? 'bg-gray-500 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600'} text-white text-xl font-bold py-6 rounded-lg transition active:scale-95`}>ENTER</button>
                  </div>
                </div>
              </div>
            );
          }

          if (phase === 'transition') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-900 via-teal-900 to-blue-900 p-4 flex items-center justify-center">
                <div className="text-center max-w-lg">
                  <Trophy className="w-24 h-24 text-yellow-300 mx-auto mb-6 animate-bounce" />
                  <h1 className="text-4xl font-bold text-yellow-300 mb-6">Phase 1 Complete!</h1>
                  <div className="bg-white/10 backdrop-blur rounded-lg p-8 mb-8">
                    <p className="text-white text-xl leading-relaxed">Continue to the next challenge...</p>
                  </div>
                  <button onClick={startPhase2} className="bg-yellow-500 hover:bg-yellow-600 text-black text-2xl font-bold px-12 py-6 rounded-lg transition active:scale-95">Continue</button>
                </div>
              </div>
            );
          }

          if (phase === 'phase2') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 p-4 flex items-center justify-center">
                <div className="w-full max-w-md">
                  <div className="text-center mb-6">
                    <div className={`text-3xl font-mono font-bold ${timeRemaining < 300 ? 'text-red-400 animate-pulse' : timeRemaining < 600 ? 'text-yellow-300' : 'text-green-300'}`}>
                      ‚è±Ô∏è {formatTime(timeRemaining)}
                    </div>
                  </div>
                  <div className="bg-white/10 backdrop-blur rounded-lg p-4 mb-6">
                    <div className="flex justify-between items-center mb-2">
                      <span className="text-yellow-300 font-semibold">Progress</span>
                      <span className="text-white font-bold">{scannedSequence.length}/10</span>
                    </div>
                    <div className="w-full bg-gray-700 rounded-full h-3">
                      <div className="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full transition-all duration-500" style={{ width: `${(scannedSequence.length / 10) * 100}%` }} />
                    </div>
                  </div>
                  <div className="bg-white/10 backdrop-blur rounded-lg p-8 mb-6 min-h-40 flex flex-col items-center justify-center">
                    {feedback ? (
                      <div className={`text-3xl font-bold text-center ${feedback.type === 'correct' ? 'text-green-400' : feedback.type === 'wrong' ? 'text-red-400' : 'text-orange-400'}`}>{feedback.message}</div>
                    ) : (
                      <div className="text-center"><div className="text-white text-xl mb-2">{scannedSequence.length === 0 ? 'Scan first card' : `Scan next card...`}</div></div>
                    )}
                  </div>
                  <div className="bg-white/10 backdrop-blur rounded-lg p-4 mb-6">
                    <p className="text-yellow-300 font-semibold mb-3">Scanned:</p>
                    <div className="flex flex-wrap gap-2">
                      {scannedSequence.map((card, i) => (
                        <div key={i} className="bg-green-500 text-white font-bold px-4 py-2 rounded-lg">{card}</div>
                      ))}
                    </div>
                  </div>
                  <div className="bg-white/10 backdrop-blur rounded-lg p-4">
                    <p className="text-gray-400 text-sm mb-3">Testing: Manual Input</p>
                    <div className="grid grid-cols-5 gap-2">
                      {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(num => (
                        <button key={num} onClick={() => handleNFCScan(num)} className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg transition active:scale-95">{num}</button>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (phase === 'phase3' && showFinalQuestion && !finalComplete) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-amber-900 via-yellow-900 to-orange-900 p-4 flex items-center justify-center">
                <div className="max-w-2xl w-full">
                  <div className="text-center mb-8">
                    <div className="text-6xl mb-4">üèõÔ∏è</div>
                    <h1 className="text-3xl font-bold text-yellow-200 mb-6">Look through the gates!</h1>
                  </div>
                  <div className="bg-white/10 backdrop-blur rounded-lg p-8 mb-8">
                    <p className="text-white text-lg leading-relaxed mb-6 text-center">
                      The Propylaea was more than just the entrance to the Acropolis.<br/>
                      The Athenians designed it as a kind of "marble frame" for a world-defining triumph that set Western civilization on its course.
                    </p>
                    <p className="text-yellow-300 text-xl font-bold text-center mb-6">When did that event take place?</p>
                    <div className="flex items-center justify-center gap-4">
                      <input type="number" value={finalAnswer} onChange={(e) => setFinalAnswer(e.target.value)} className="bg-white/20 text-white text-4xl font-bold text-center w-32 py-4 rounded-lg border-2 border-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-300" placeholder="___" maxLength="3" />
                      <span className="text-white text-3xl font-bold">BC</span>
                    </div>
                  </div>
                  {feedback && (
                    <div className={`text-center text-2xl font-bold mb-4 ${feedback.type === 'correct' ? 'text-green-400' : 'text-red-400'}`}>
                      {feedback.message}
                    </div>
                  )}
                  <button onClick={handleFinalAnswer} disabled={finalAnswer.length < 3} className="w-full bg-yellow-500 hover:bg-yellow-600 disabled:bg-gray-500 text-black text-2xl font-bold py-6 rounded-lg transition active:scale-95">Submit Answer</button>
                </div>
              </div>
            );
          }

          if (phase === 'phase3' && finalComplete) {
            const minutes = Math.floor(gameStats.totalTime / 60);
            const seconds = gameStats.totalTime % 60;
            return (
              <div className="min-h-screen bg-gradient-to-br from-yellow-600 via-orange-600 to-red-600 p-4 flex items-center justify-center">
                <div className="text-center max-w-lg">
                  <Trophy className="w-32 h-32 text-white mx-auto mb-6 animate-bounce" />
                  <h1 className="text-4xl font-bold text-white mb-8">You have triumphed!</h1>
                  <div className="bg-white/20 backdrop-blur rounded-lg p-8 mb-8">
                    <h2 className="text-white text-2xl font-bold mb-6">Your Stats</h2>
                    <div className="space-y-4 text-white text-lg">
                      <div className="flex justify-between items-center border-b border-white/30 pb-3">
                        <span className="font-semibold">Time:</span>
                        <span className="text-yellow-200 text-2xl font-mono">{minutes}:{seconds.toString().padStart(2, '0')}</span>
                      </div>
                      <div className="flex justify-between items-center border-b border-white/30 pb-3">
                        <span className="font-semibold">Correct Answers:</span>
                        <span className="text-green-300 text-2xl">{gameStats.correctAnswers}/11</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="font-semibold">Helps Used:</span>
                        <span className="text-blue-300 text-2xl">{gameStats.jokersUsed}</span>
                      </div>
                    </div>
                  </div>
                  <button onClick={resetGame} className="bg-white hover:bg-gray-100 text-black text-xl font-bold px-8 py-4 rounded-lg transition active:scale-95 flex items-center gap-2 mx-auto">
                    <RotateCcw className="w-6 h-6" />Play Again
                  </button>
                </div>
              </div>
            );
          }

          if (phase === 'phase3') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
                <div className="max-w-md mx-auto">
                  <div className="text-center mb-6">
                    <div className={`text-3xl font-mono font-bold ${timeRemaining < 300 ? 'text-red-400 animate-pulse' : timeRemaining < 600 ? 'text-yellow-300' : 'text-green-300'}`}>
                      ‚è±Ô∏è {formatTime(timeRemaining)}
                    </div>
                  </div>
                  {!gpsEnabled ? (
                    <div className="flex flex-col items-center justify-center min-h-[500px]">
                      <button onClick={enableGPS} className="bg-green-500 hover:bg-green-600 text-white text-2xl font-bold px-12 py-6 rounded-lg transition active:scale-95 mb-4 shadow-lg">Enable GPS</button>
                      {feedback && <div className={`text-lg font-bold mb-2 ${feedback.type === 'correct' ? 'text-green-400' : 'text-red-400'}`}>{feedback.message}</div>}
                      {gpsError && <div className="text-red-400 text-sm text-center max-w-xs bg-black/50 p-3 rounded mt-2">{gpsError}</div>}
                    </div>
                  ) : (
                    <>
                      <div className="fixed top-6 right-6 z-50">
                        <div className={`w-20 h-20 rounded-full ${distance ? 'bg-green-500' : 'bg-gray-600'}`} style={{ animation: distance ? `blink ${getBeepInterval(distance) / 1000}s ease-in-out infinite` : 'none', boxShadow: distance ? '0 0 30px rgba(34, 197, 94, 0.8)' : 'none' }} />
                      </div>
                      <div className="bg-white/10 backdrop-blur rounded-lg p-8 mb-6 mt-8">
                        <div className="relative w-72 h-72 mx-auto bg-gray-800 rounded-full shadow-2xl border-4 border-amber-700 flex items-center justify-center">
                          <div className="absolute transition-transform duration-1000" style={{ transform: `rotate(${bearing}deg)` }}>
                            <div className="w-2 bg-red-500 rounded-full" style={{ height: '120px', marginLeft: '-4px' }}>
                              <div className="w-0 h-0 absolute -top-2" style={{ borderLeft: '8px solid transparent', borderRight: '8px solid transparent', borderBottom: '16px solid #ef4444', left: '-6px' }} />
                            </div>
                          </div>
                        </div>
                      </div>
                      {distance !== null && (
                        <div className="bg-white/10 backdrop-blur rounded-lg p-6 text-center">
                          <div className="text-white text-5xl font-bold mb-2">{distance.toFixed(1)}m</div>
                          {userLocation && <div className="text-gray-400 text-xs">GPS: {userLocation.lat.toFixed(6)}, {userLocation.lng.toFixed(6)}</div>}
                        </div>
                      )}
                      {gpsError && (
                        <div className="bg-red-500/20 backdrop-blur rounded-lg p-3 text-center mt-4">
                          <div className="text-red-300 text-sm">{gpsError}</div>
                        </div>
                      )}
                    </>
                  )}
                </div>
                <style>{`
                  @keyframes blink {
                    0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 40px rgba(34, 197, 94, 1); }
                    50% { opacity: 0.2; transform: scale(0.9); box-shadow: 0 0 10px rgba(34, 197, 94, 0.3); }
                  }
                `}</style>
              </div>
            );
          }

          return null;
        };

        ReactDOM.render(<TreasureHunt />, document.getElementById('root'));
    </script>
</body>
</html>
